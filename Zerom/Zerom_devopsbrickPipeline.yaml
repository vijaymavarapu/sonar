pipeline {

    agent any

    stages {

       stage('Git Checkout') {

            steps {

                script {
                    git branch: 'dev-raju-jenkintest',
                        credentialsId: '9f4270ce-1a82-4ad2-a18d-db2d774c2c7a',
                        //credentialsId: '9f4270ce-1a82-4ad2-a18d-db2d774c2c7a',
                        url: 'https://devopsbricks@dev.azure.com/devopsbricks/ML-Projects/_git/MLOps-Accelator'

                   // git branch: 'dev-raju-jenkintest',

                    //    url: 'https://Raju.Gupta:enjscxrmjpfnqg67v4awplrecfmuikk2jcdf245w5ch6udwraaeq@dev.azure.com/devopsbricks/ML-Projects/_git/MLOps-Accelator'

                }

            }

        }

        stage('Build') {

            steps { 

                script {    

      try {

                      //  sh 'test_script.sh'

                      dir("ProjectA/Components/ComponentA"+"/") {

                      // dir("${params.ProjectName}"+"/Components/"+"${params.ComponentName}"+"/") { 

                        //sh "sudo docker build -t rajugupta8019/${params.ProjectName.toLowerCase()}_${params.ComponentName.toLowerCase()}:${params.version} ."

                        sh "sudo docker build -t rajugupta8019/latest ."

    }   

                    } catch (e) {

                        echo "An error occurred: ${e}"

                       //  writeFile(file: "${params.ProjectName.toLowerCase()}_${params.ComponentName.toLowerCase()}_error.txt", text: "An error occurred: ${e}")

                        // throw new Exception("Something went wrong!")

                          sh "ls -l"

                    }

                }

            }

        }
 
        stage('Login to Docker Hub') {      	

            steps{                       	

	              sh 'sudo docker login -u raju.gupta@cyient.com -p P@ssword12345'                		

	              echo 'Login Completed'      

            }           

        }  

    stage('Push') {

      steps {

       // sh "sudo docker push rajugupta8019/${params.ProjectName.toLowerCase()}_${params.ComponentName.toLowerCase()}:${params.version}"

          sh "sudo docker push rajugupta8019/latest"

      }

    }

    }

}